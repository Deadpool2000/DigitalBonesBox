<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bone Information Viewer</title>
    <style>
        .container {
            width: 80%;
            margin: auto;
            text-align: left;
        }
        .annotations {
            text-align: left;
            margin-top: 20px;
        }
        ul {
            list-style-type: disc;
        }
    </style>
</head>
<body>

    <h1>Bone Information Viewer</h1>

    <!-- Button to Load the Bone Sets -->
     <div>
        <button id="load-button">Load Options</button>
     </div>

    <label for="bonesets">Choose a Boneset:</label>


    <select id="boneset-select">
        <option value="">--Please choose an option--</option>
    </select>       

    <script>
        const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/oss-slu/DigitalBonesBox/data/databones/json/';
        const BONESET_JSON_PATH = 'boneset.json';

        async function fetchJSON(path) {
            const response = await fetch(GITHUB_RAW_URL + path);
            return response.json();
        }

        async function populateDropdown() {
            const data = await fetchJSON(BONESET_JSON_PATH);
            const dropdown = document.getElementById('boneset-select');

    // Clear existing options
            // dropdown.innerHTML = '<option value="">--Please choose an option--</option>';

    // Add new options from JSON data
            data.boneset.forEach(bone => {
                const option = document.createElement('option');
                option.value = bone.id;
                option.textContent = bone.name;
                dropdown.appendChild(option);
            });
        }

// Add event listener for the button
        document.getElementById('load-button').addEventListener('click', populateDropdown);
    </script>
    
    <div>
        <button id="load-sets-button">Load Sets</button>
    </div>

    <!-- Container for the Boneset Names and IDs -->
    <div id="bone-sets-container">
        <h2>Boneset</h2>
        <ul id="bone-set-list"></ul>
    </div>

    <script>
        // Corrected GitHub raw URL
        async function fetchBonesetData() {
            const response = await fetch(GITHUB_RAW_URL + BONESET_JSON_PATH);
            const data = await response.json();
            return data.boneset;
        }

        // Function to load the boneset data and display it
        async function loadBoneSets() {
        const dropdown = document.getElementById('boneset-select');
        const selectedOption = dropdown.options[dropdown.selectedIndex];
        const selectedBoneName = selectedOption.textContent;

        try {
            const bonesets = await fetchBonesetData();
            console.log(bonesets);  // Check the fetched data

            const boneSetList = document.getElementById('bone-set-list');
            boneSetList.innerHTML = '';  // Clear any previous data

            // Find the selected boneset based on the dropdown selection
            const selectedSet = bonesets.find(set => set.name === selectedBoneName);

            if (selectedSet) {
                // Create a list item for the selected boneset name
                const li = document.createElement('li');
                li.textContent = selectedSet.name;
                boneSetList.appendChild(li);

                // Create a sublist for the bone IDs
                const subList = document.createElement('ul');
                selectedSet.bones.forEach(bone => {
                    const subLi = document.createElement('li');
                    subLi.textContent = `ID: ${bone}`;
                    subList.appendChild(subLi);
                });

                // Append the sublist under the boneset name
                boneSetList.appendChild(subList);
            } else {
                boneSetList.textContent = 'No bone set found for the selected option.';
            }
        } catch (error) {
            console.error('Error loading bonesets:', error);
        }
    }
        // Add event listener to the button to load the bone sets on click
        document.getElementById('load-sets-button').addEventListener('click', loadBoneSets);
    </script>
</body>
</html>
